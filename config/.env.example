# ============================================================
# TradeCat 配置模板
# ============================================================
# 
# 使用方法：
#   1. 复制此文件为 .env：cp .env.example .env
#   2. 修改 .env 中的配置值
#   3. 设置权限：chmod 600 .env
#   4. 重启服务生效
# 
# 注意：.env 包含敏感信息，已在 .gitignore 中排除
# 
# ============================================================

# ============================================================
# 网络代理
# ============================================================
# 用于访问 Binance API 和 Telegram API（国内需要代理）
# 格式：http://IP:端口 或 socks5://IP:端口
# 留空则不使用代理
HTTP_PROXY=
HTTPS_PROXY=

# 数据库连接
# 旧库 (已停用示例)：postgresql://postgres:postgres@localhost:5433/market_data
# 新库：TimescaleDB@5434（raw/agg/quality 架构）
DATABASE_URL=postgresql://postgres:postgres@localhost:5434/market_data
MARKET_DB_SCHEMA=market_data   # 兼容旧表/视图用
RAW_DB_SCHEMA=raw              # 1m K线、5m指标真实写入
QUALITY_DB_SCHEMA=quality      # 批次/血缘函数所在 schema


# ============================================================
# Telegram Bot（必填）
# ============================================================
# 从 @BotFather 获取的 Bot Token
# 格式：数字:字母数字字符串（如 123456789:ABCdefGHI...）
# 获取方式：Telegram 搜索 @BotFather → /newbot → 按提示创建
BOT_TOKEN=

# 管理员用户ID（逗号分隔，可配置多个）
# 管理员可以访问配置面板、管理Bot设置
# 获取方式：Telegram 搜索 @userinfobot 获取你的用户ID
ADMIN_USER_IDS=

# ============================================================
# 国际化（i18n）
# ============================================================
# 默认语言（与 locales 目录一致），例：zh-CN / en
DEFAULT_LOCALE=en
# 支持的语言列表（逗号分隔，需有对应翻译文件）
SUPPORTED_LOCALES=zh-CN,en
# 回退语言（翻译缺失时使用）
FALLBACK_LOCALE=zh-CN

# ============================================================
# Binance API（可选）
# ============================================================
# 用于获取账户信息、下单等功能（order-service 需要）
# 仅采集公开市场数据时可留空
# 获取方式：https://www.binance.com/zh-CN/my/settings/api-management
# 注意：建议只开启读取权限，不要开启交易权限（除非使用 order-service）
BINANCE_API_KEY=
BINANCE_API_SECRET=

# ============================================================
# 币种管理（核心配置）
# ============================================================
# 
# SYMBOLS_GROUPS 控制采集、计算、展示哪些币种
# 此配置同时作用于：data-service、trading-service、telegram-service
# 
    # 可选值：
    #   main4  - 默认主流 4 币（BTC/ETH/SOL/BNB）
    #   main6  - 使用 SYMBOLS_GROUP_main6 定义的 6 个主流币
    #   main20 - 使用 SYMBOLS_GROUP_main20 定义的 20 个主流币
    #   auto   - 自动选择高优先级币种（约 130-150 个）
    #   all    - 全部 USDT 永续合约（600+），资源消耗大
    #   亦可组合：defi,meme 等分组并行
    #
    SYMBOLS_GROUPS=main4

# ---------- 预定义分组 ----------
# 可自定义分组，格式：SYMBOLS_GROUP_分组名=币种1,币种2,...
# 币种必须是 Binance 永续合约交易对（以 USDT 结尾）
# 可在 https://www.binance.com/zh-CN/futures/trading-rules/perpetual 查看所有交易对

# 主流币 Top 4（默认）
SYMBOLS_GROUP_main4=BTCUSDT,ETHUSDT,BNBUSDT,SOLUSDT

# 主流币 Top 6（BTC、ETH、BNB、SOL、XRP、DOGE）
SYMBOLS_GROUP_main6=BTCUSDT,ETHUSDT,BNBUSDT,SOLUSDT,XRPUSDT,DOGEUSDT

# 主流币 Top 20
SYMBOLS_GROUP_main20=BTCUSDT,ETHUSDT,BNBUSDT,SOLUSDT,XRPUSDT,ADAUSDT,DOGEUSDT,AVAXUSDT,DOTUSDT,LINKUSDT,MATICUSDT,LTCUSDT,UNIUSDT,ATOMUSDT,ETCUSDT,XLMUSDT,APTUSDT,NEARUSDT,FILUSDT,ARBUSDT

# DeFi 板块（去中心化金融）
SYMBOLS_GROUP_defi=AAVEUSDT,UNIUSDT,MKRUSDT,COMPUSDT,SNXUSDT,CRVUSDT,LDOUSDT,PENDLEUSDT

# Meme 板块（模因币）
SYMBOLS_GROUP_meme=DOGEUSDT,SHIBUSDT,PEPEUSDT,FLOKIUSDT,BONKUSDT,WIFUSDT,BOMEUSDT

# AI 板块（人工智能相关）
SYMBOLS_GROUP_ai=FETUSDT,AGIXUSDT,OCEANUSDT,RENDERUSDT,TAOUSDT,ARKMUSDT

# Layer2 板块（以太坊二层扩展）
SYMBOLS_GROUP_layer2=ARBUSDT,OPUSDT,MATICUSDT,STXUSDT,IMXUSDT,METISUSDT

# ---------- 额外添加/排除 ----------
# 在分组基础上额外添加币种（逗号分隔）
# 示例：SYMBOLS_EXTRA=NEWUSDT,HOTUSDT
SYMBOLS_EXTRA=

# 强制排除的币种（逗号分隔，优先级最高，会从任何分组中移除）
# 示例：SYMBOLS_EXCLUDE=LUNAUSDT,USTCUSDT
SYMBOLS_EXCLUDE=

# ============================================================
# 周期配置
# ============================================================
# K线周期（逗号分隔）
# 可选：1m, 3m, 5m, 15m, 30m, 1h, 2h, 4h, 6h, 8h, 12h, 1d, 3d, 1w, 1M
# 周期越多，数据量和计算量越大
INTERVALS=1m,5m,15m,1h,4h,1d,1w

# K线采集周期（data-service WebSocket 订阅使用）
KLINE_INTERVALS=1m,5m,15m,1h,4h,1d,1w

# 期货指标周期（data-service REST API 采集使用）
# 注意：Binance 期货指标最小粒度为 5m，无 1m 数据
FUTURES_INTERVALS=5m,15m,1h,4h,1d,1w

# ============================================================
# 数据保留策略
# ============================================================
# 每个币种每个周期在 SQLite 中保留的记录条数
# 超出后自动清理旧数据，控制数据库大小
# 
# 计算公式：保留时长 = 条数 × 周期
# 例：RETENTION_1m=120 表示保留 120 分钟 = 2 小时
#     RETENTION_1d=120 表示保留 120 天 = 4 个月
#
RETENTION_1m=120
RETENTION_5m=120
RETENTION_15m=96
RETENTION_1h=144
RETENTION_4h=84
RETENTION_1d=120
RETENTION_1w=48

# ============================================================
# data-service 配置（数据采集服务）
# ============================================================
# 
# 回填模式（首次启动或数据缺失时使用）：
#   all  - 全量回填（默认，按起始日或 10 年上限）
#   days - 按天数回填（使用 BACKFILL_DAYS）
#   none - 禁用回填
#   full 兼容映射为 all
BACKFILL_MODE=all

# 回填起始日期（可选，BACKFILL_MODE=all 时优先使用）
# 留空则默认回溯约 10 年
# 示例：BACKFILL_START_DATE=2018-01-01
BACKFILL_START_DATE=

# 回填天数（BACKFILL_MODE=days 时生效）
# 建议值：7-30 天
BACKFILL_DAYS=30

# 启动时是否先跑一次全量补齐（true/false）
BACKFILL_ON_START=false

# 最大并发请求数（控制对 Binance API 的并发访问）
# 建议值：3-10，过高可能触发限流
MAX_CONCURRENT=5

# 每分钟最大请求数（Binance 限制约 1200/分钟）
# 建议留 30% 余量，设为 800-1000
RATE_LIMIT_PER_MINUTE=1800

# WebSocket 断线重连检查间隔（秒）
# 检测 WebSocket 连接是否正常，断线后自动重连
BINANCE_WS_GAP_INTERVAL=600

# WebSocket 数据源
#   binance_ws   - 官方 WebSocket（推荐，延迟低）
#   cryptofeed   - cryptofeed 库（备用，兼容性好）
BINANCE_WS_SOURCE=binance_ws

# ============================================================
# trading-service 配置（指标计算服务）
# ============================================================
# 
# SQLite 数据库路径（指标计算结果存储位置）
# 默认写入 Telegram 指标库，供 Bot/可视化读取
# 支持相对路径（相对项目根目录），留空回退到默认路径
# 示例：INDICATOR_SQLITE_PATH=libs/database/services/telegram-service/market_data.db
INDICATOR_SQLITE_PATH=/home/lenovo/.projects/tradecat/libs/database/services/telegram-service/market_data.db

# 计算线程/进程数
# 建议值：CPU 核心数，过高会导致资源竞争
MAX_WORKERS=4

# 计算后端：
#   thread  - 线程池（推荐，适合 IO 密集型，内存占用低）
#   process - 进程池（适合 CPU 密集型，但内存占用高）
#   hybrid  - 混合模式（小任务用线程，大任务用进程）
COMPUTE_BACKEND=thread

# auto 模式下的高优先级币种数量上限
# 影响 SYMBOLS_GROUPS=auto 时选择的币种数量
HIGH_PRIORITY_TOP_N=50

# ---------- 指标开关 ----------
# 只启用指定指标（逗号分隔，留空=全部启用）
# 可用于调试或减少计算量
# 示例：INDICATORS_ENABLED=macd,rsi,布林带
INDICATORS_ENABLED=

# 禁用指定指标（逗号分隔）
# 示例：INDICATORS_DISABLED=k线形态,支撑阻力
INDICATORS_DISABLED=

# ============================================================
# telegram-service 配置（Telegram Bot 服务）
# ============================================================
# 
# 是否禁用 Binance API 调用（1=禁用，0=启用）
# 禁用后：不获取实时价格，使用 SQLite 缓存数据
# 启用后：可获取实时价格，但需要配置代理
#
BINANCE_API_DISABLED=1

# ---------- 单币快照功能 ----------
# 用户发送 "BTC!" 触发单币详情查询
# 0=启用, 1=禁用（性能优化时可临时关闭）
#
DISABLE_SINGLE_TOKEN_QUERY=0

# 单币快照屏蔽字段（逗号分隔）
# 这些字段不会在单币查询表格中显示
# 示例：SNAPSHOT_HIDDEN_FIELDS=最近翻转时间,某字段
#
SNAPSHOT_HIDDEN_FIELDS=最近翻转时间

# ---------- 卡片开关 ----------
# 只启用指定卡片（逗号分隔，留空=全部启用）
# 示例：CARDS_ENABLED=资金流向,MACD,RSI
CARDS_ENABLED=

# 禁用指定卡片（逗号分隔）
# 示例：CARDS_DISABLED=K线形态,支撑阻力
CARDS_DISABLED=

# ---------- 屏蔽币种（黑名单）----------
# 这些币种不会出现在排行榜中（逗号分隔）
# 用于屏蔽已下架、异常或不想显示的币种
# 与 SYMBOLS_EXCLUDE 不同：BLOCKED_SYMBOLS 只影响展示，不影响采集和计算
BLOCKED_SYMBOLS=BNXUSDT,ALPACAUSDT

# ============================================================
# ai-service 配置（AI 数据服务）
# ============================================================
# 
# 控制 AI 服务从 SQLite 获取哪些指标表
# 减少表数量可显著降低 payload 大小，提升 LLM 处理效率
#

# ---------- 指标表选择 ----------
# 启用的指标表（逗号分隔，留空=全部 38 张表）
# 
AI_INDICATOR_TABLES=

# 禁用的指标表（逗号分隔，优先级高于 AI_INDICATOR_TABLES）
# 示例：AI_INDICATOR_TABLES_DISABLED=数据监控.py,期货情绪缺口监控.py
AI_INDICATOR_TABLES_DISABLED=

# ============================================================
# order-service 配置（交易执行服务）
# ============================================================
# 使用此服务需要配置 BINANCE_API_KEY 和 BINANCE_API_SECRET
# 并确保 API Key 有交易权限
# 
# 警告：交易有风险，请在测试网充分测试后再使用真实资金
# Binance 测试网：https://testnet.binancefuture.com
#
# （暂无其他配置项）

# ============================================================
# markets-service 配置（全市场数据采集服务）
# ============================================================
# 独立数据库连接（留空则复用全局 DATABASE_URL）
# 推荐使用 5434 端口的新库（含 raw/agg/quality schema）
MARKETS_SERVICE_DATABASE_URL=postgresql://postgres:postgres@localhost:5434/market_data

# 加密货币写入模式:
#   raw    - 写入 raw.crypto_kline_1m (新架构，含血缘追踪)
#   legacy - 写入 market_data.candles_1m (兼容 trading-service)
CRYPTO_WRITE_MODE=raw

# ---------- 订单簿双层采样配置 (行业最佳实践) ----------
# L1 Tick 层: 高频采样，捕获价差/失衡信号
# L2 Full 层: 低频采样，保存完整盘口

# L1 tick 采样间隔（秒），默认 1
# 建议: 1-2s，捕获 95%+ 价差变化
ORDER_BOOK_TICK_INTERVAL=1

# L2 full 采样间隔（秒），默认 5
# 建议: 5-10s，平衡存储与精度
ORDER_BOOK_FULL_INTERVAL=5

# 每侧档位数，默认 1000（全量）
ORDER_BOOK_DEPTH=1000

# 数据保留天数
# tick 层自动保留 7 天，full 层保留此配置天数
ORDER_BOOK_RETENTION_DAYS=30

# 指定币种（可选，逗号分隔，不设则用 SYMBOLS_GROUPS）
# ORDER_BOOK_SYMBOLS=BTCUSDT,ETHUSDT

# ============================================================
# vis-service 配置（可视化渲染服务）
# ============================================================
# 监听地址与端口
VIS_SERVICE_HOST=0.0.0.0
VIS_SERVICE_PORT=8087

# 访问令牌（可选，若设置则所有请求需携带头 X-Vis-Token）
VIS_SERVICE_TOKEN=

# 数据源（留空默认复用全局 DATABASE_URL / INDICATOR_SQLITE_PATH）
VIS_SERVICE_DATABASE_URL=
VIS_SERVICE_INDICATOR_SQLITE_PATH=

# 渲染缓存（秒）与容量
VIS_SERVICE_CACHE_TTL_SECONDS=300
VIS_SERVICE_CACHE_MAX_ITEMS=128
