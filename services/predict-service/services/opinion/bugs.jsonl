{"ts":"2025-12-25T02:15:25+08:00","id":"BUG-20251225-001","title":"WS 实时市场消息未被解析导致无信号","symptom":"启动 live-signal-monitor.js 后 WebSocket 已订阅但价格/交易/订单簿信号始终为 0，仅 REST 新市场可见","root_cause":"Polymarket WS 推送为 event_type 对象数组，被当作 [type,payload] 格式处理，导致类型判断失败，全部消息被忽略","fix":["新增 normalizeEvent 将 event_type/ type+data/旧数组格式归一化","processMessage 接收 (type,payload) 并按实际事件分发","为解析失败输出错误日志便于排查"],"files_changed":["live-signal-monitor.js"],"repro_steps":["GLOBAL_AGENT_HTTP_PROXY=http://127.0.0.1:9910 node live-signal-monitor.js","观察统计：消息计数不增长且所有信号计数保持 0"],"verification":{"commands":["GLOBAL_AGENT_HTTP_PROXY=http://127.0.0.1:9910 timeout 12s node live-signal-monitor.js"],"result":"收到 book 消息并触发流动性/订单簿信号，消息计数增长"},"impact":"实时信号基本全部缺失，监控失效","prevention":["对外部 WS 协议保持显式格式归一化层","为关键通道添加解析单元测试或集成回放"],"tags":["websocket","parsing","polymarket","signals","bugfix"],"followups":["添加针对 event_type 样本的 replay 测试"]}
{"ts":"2025-12-26T06:17:05+08:00","id":"BUG-20251226-001","title":"扫尾盘仍受成交量排序截断","symptom":"配置已将 minVolume/minLiquidity 设为0，但扫尾盘仍仅展示约50条，低成交量/低流动性市场缺失","root_cause":"analyzeMarkets 先按 score 排序并 slice maxMarkets=50，score 受成交量/流动性/价格确定性影响；Gamma getMarkets limit 200 截断；processMarket 仍对价格偏离做过滤","fix":["提升 Gamma fetch limit 至 500","移除成交量/流动性/价格偏离/绝对阈值过滤","排序仅按剩余时间并取消 maxMarkets 裁剪","日志改为显示时间窗口内数量"],"files_changed":["services/polymarket/signals/closing/detector.js"],"repro_steps":["保持 closing.enabled=true，timeWindowHours=168","运行扫尾盘 scan，观测获取市场数远大于输出列表但输出被限定在50左右"],"verification":{"commands":[],"result":"TODO"},"impact":"扫尾盘提示遗漏大量 7 天内到期市场，造成监控盲区","prevention":["排序或裁剪前明确需求，不混入打分指标","为 closing 模块添加覆盖时间过滤的单元测试","在日志中明确限制来源（时间窗口/分页/telegram分页）"],"tags":["closing","filter","ranking","polymarket","bugfix"],"followups":["若 7 天内市场>500 需增加分页/分批拉取","考虑将 score 计算与排序解耦并加入测试"]}
